<div id="scope-panel" class="right panel" <% if cookies['scope-panel.width'] %>style="width: <%=cookies['scope-panel.width']%>px"<% end %>>
	<div class="back">
		<div class="shadow"></div>
	</div>
	<a href="#" class="ui-resizable-handle ui-resizable-w toggle"></a>
	<div class="cont">
		
		<div id="scope-list">
			<h1 class="header">Piles</h1>
			
			<div class="scope name <%= 'base' if @pile == @owner.root_pile %>">
				<span class="sym"><%# ∴ %>&there4;</span>
				<%- if @pile == @owner.root_pile -%>
					<span><%=h @owner.login%></span>
				<%- else -%>
					<%= link_to h(@owner.login), [@owner, @owner.root_pile] %>
				<%- end -%>
			</div>
			
			<ul>
				<%= render :partial => 'piles/list_scopes', :locals => { :pile => @owner.root_pile, :expand_to => lambda {|p| p == @pile || @pile.ancestors.include?(p) }, :base_scope => @pile } %>
			</ul>
		</div>
		
	</div>
</div>

<div id="main-area" class="left" <% if cookies['scope-panel.width'] %>style="margin-right: <%=cookies['scope-panel.width']%>px"<% end %>><% @skip_main_area_wrap = true %>
	<div class="cont">
		
		<% content_tag_for :div, @pile.root_node, :class => "base root item" do -%>
			<%- cache ({:base_node_section => @pile.root_node.id}.to_json) do -%>
				<section class="base pile cont" oc:nodes-url="<%=path_for([@owner, @pile, :nodes])%>">
					
					<div class="body">
						<div class="back"></div>
						
						<%= render_subscoped :partial => 'nodes/action_stub', :subscope => :modifiable %>
						
						<h1 class="header" onclick="void(0)"><%# onclick, for MobileSafari, with Love -%>
							<% unless @pile.root? %><a href="<%=path_for [@owner, @owner.root_pile]%>" class="owner pile name link"><%= @owner.name %> <span class="sym"><%# » %>&raquo;</span></a><% end %>
							<% (@pile.ancestors.reverse - [@owner.root_pile]).each do |ancestor_pile| %>
								<a href="<%=path_for [@owner, ancestor_pile]%>" class="ancestor pile name link"><%= ancestor_pile.name %> <span class="sym"><%# » %>&raquo;</span></a>
							<% end %>
							<span class="base pile name"><%= @pile.root? ? @pile.owner.name : @pile.name %></span>
						</h1>
					</div>
					
					<ul class="item-list">
						<%= render_subscoped :partial => 'nodes/list_items', :locals => {:item => @pile.root_node}, :subscope => :modifiable %>
					</ul>
					
					<%= render_subscoped :partial => 'nodes/action_bar', :subscope => :modifiable %>
					
				</section>
			<%- end -%>
		<%- end -%>
		
	</div>
</div>
